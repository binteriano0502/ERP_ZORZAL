@model ERP_GMEDINA.Models.tbProducto
@using ERP_GMEDINA.Models

@{
    ViewBag.Title = "Editar";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@{
    var ListadoSuCategoria = new ERP_GMEDINA.Models.tbProductoSubcategoria();
    var ListadoCategoria = new ERP_GMEDINA.Models.tbProductoCategoria();
}


<div class="row wrapper border-bottom white-bg page-heading">
    <div class="col-sm-4">
        <h2>Editar Producto</h2>

    </div>
 

    <div class="col-sm-8">
        <div class="title-action">
            <a href="@Url.Action("Index","Producto")">Regresar</a>
        </div>
    </div>
</div>



<div class="wrapper wrapper-content animated fadeInRight">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-title">
                    <h5>Editar Producto</h5>
                </div>
                <div class="ibox-content">

				@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()

                    <div class="form-horizontal">

                        @Html.ValidationSummary(true)
                        @Html.HiddenFor(model => model.prod_Codigo)

                        @Html.HiddenFor(model => model.prod_UsuarioCrea)
                        @Html.HiddenFor(model => model.prod_FechaCrea)
                        @Html.HiddenFor(model => model.prod_UsuarioModifica)
                        @Html.HiddenFor(model => model.prod_FechaModifica)
                        @Html.HiddenFor(model => model.tbUsuario.usu_Nombres)
                        @Html.HiddenFor(model => model.tbUsuario.usu_Apellidos)
                        @Html.HiddenFor(model => model.tbUsuario1.usu_Nombres)
                        @Html.HiddenFor(model => model.tbUsuario1.usu_Apellidos)

                        @*Esto lo agregó Mágdaly Zúniga*@
                        @*Extras usuario crea*@
                        @Html.HiddenFor(model => model.tbUsuario.usu_NombreUsuario)
                        @Html.HiddenFor(model => model.tbUsuario.usu_Password)
                        @Html.HiddenFor(model => model.tbUsuario.usu_Correo)
                        @Html.HiddenFor(model => model.tbUsuario.usu_EsActivo)
                        @Html.HiddenFor(model => model.tbUsuario.usu_EsAdministrador)

                        @*Extras usuario crea*@
                        @Html.HiddenFor(model => model.tbUsuario1.usu_NombreUsuario)
                        @Html.HiddenFor(model => model.tbUsuario1.usu_Password)
                        @Html.HiddenFor(model => model.tbUsuario1.usu_Correo)
                        @Html.HiddenFor(model => model.tbUsuario1.usu_EsActivo)
                        @Html.HiddenFor(model => model.tbUsuario1.usu_EsAdministrador)


                        <div class="form-group">
                            <label class="control-label col-md-2">Categoria<span style="color:red">*</span></label>
                            <div class="col-md-4">
                                @Html.DropDownList("pcat_Id", (IEnumerable<SelectListItem>)ViewBag.tbProductoCategoriaList, new { @class = "form-control col-md-6"@*, @id = "pcat_Id"*@ })
                                @*<p style="color:red">@Html.ValidationMessageFor(model => model.pscat_Id)</p>*@
                                <p style="color:red">@Html.ValidationMessageFor(muni => ListadoCategoria.pcat_Id)</p>
                            </div>

                            <label class="control-label col-md-2">SubCategoria<span style="color:red">*</span></label>
                            <div class="col-md-4">
                                @Html.DropDownList("pscat_Id",null,"Seleccione", new { @class = "form-control" })
                                <p style="color:red">@Html.ValidationMessageFor(model => model.pscat_Id)</p>
                            </div>
                        </div>                       

                        <div class="form-group">
                            @Html.LabelFor(model => model.prod_Codigo, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_Codigo, new { htmlAttributes = new  { @class = "form - control" , @id = "Codigo" }  })
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Codigo)</p>
                            </div>

                            @Html.LabelFor(model => model.prod_CodigoBarras, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_CodigoBarras)
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_CodigoBarras)</p>
                            </div>
                            
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.prod_Descripcion, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_Descripcion)
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Descripcion)</p>
                            </div>

                            @Html.LabelFor(model => model.prod_Marca, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_Marca)
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Marca)</p>
                            </div>
                            
                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.prod_Modelo, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_Modelo)
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Modelo)</p>
                            </div>

                            @Html.LabelFor(model => model.prod_Color, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_Color)
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Color)</p>
                            </div>
                            

                        </div>

                        <div class="form-group">
                            @Html.LabelFor(model => model.prod_Talla, new { @class = "control-label col-md-2" })
                            <div class="col-md-4">
                                @Html.EditorFor(model => model.prod_Talla)
                                <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Talla)</p>
                            </div>

                            <label class="control-label col-md-2">Unidad Medida<span style="color:red">*</span></label>
                            @*@Html.LabelFor(model => model.uni_Id, "Unidad Medida", new { @class = "control-label col-md-2" })*@
                            <div class="col-md-4">
                                @Html.DropDownList("uni_Id", null, new { @class = "form-control" })
                                <p style="color:red">@Html.ValidationMessageFor(model => model.uni_Id)</p>
                            </div>                                                                       
                        </div>    
                        
                        
                        
                            <div class="form-group" id="Activo" name="Activo">
                                @Html.LabelFor(model => model.prod_EsActivo, new { @class = "control-label col-md-2" })
                                <div class="col-md-4">
                                    @Html.EditorFor(model => model.prod_EsActivo, new { htmlAttributes = new { @type = "checkbox", @checked = "true" } })
                                    <p style="color:red">@Html.ValidationMessageFor(model => model.prod_EsActivo)</p>
                                </div>
                            

                            <div class="form-group" id="RazonInactivo">
                                @Html.LabelFor(model => model.prod_Razon_Inactivacion, new { @class = "control-label col-md-2" })
                                <div class="col-md-4">
                                    @Html.EditorFor(model => model.prod_Razon_Inactivacion, new { @class = "form-control" })
                                    <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Razon_Inactivacion)</p>
                                </div>
                            </div>
                        </div>

                            <div class="ibox-content">
                                <table class="table table-striped">
                                    <tr>
                                        <th>Acción</th>
                                        <th>Usuario</th>
                                        <th>Fecha</th>
                                    </tr>
                                    <tr>
                                        <td>Creado</td>
                                        <td>@Html.DisplayFor(model => model.tbUsuario1.usu_Nombres) @Html.DisplayFor(model => model.tbUsuario1.usu_Apellidos)</td>
                                        <td>@Html.DisplayFor(model => model.prod_FechaCrea)</td>
                                    </tr>
                                    <tr>
                                        <td>Modificado</td>
                                        <td> @Html.DisplayFor(model => model.tbUsuario.usu_Nombres) @Html.DisplayFor(model => model.tbUsuario.usu_Apellidos)</td>
                                        <td>@Html.DisplayFor(model => model.prod_FechaModifica)</td>
                                    </tr>
                                </table>
                            </div>

                            <div class="form-group">
                                <div class="col-md-offset-2 col-md-10">
                                    <input type="submit" value="Guardar" class="btn btn-primary" />
                                    @Html.ActionLink("Cancelar", "Index", null, new { @class = "btn btn-white" })
                                </div>
                            </div>
                        </div>
                }
                </div>
            </div>
        </div>
    </div>
 </div>

@section Scripts{
@Scripts.Render("~/bundles/jqueryval")
    <script>
        jQuery('input,select').each(function () {
            var req = jQuery(this).attr('data-val-required');
            if (undefined != req) {
                var label = jQuery('label[for="' + jQuery(this).attr('id') + '"]');
                var text = label.text();
                if (text.length > 0) {
                    label.append('<span style="color:red"> *</span>');
                }
            }
        });

    </script>
   

}

<script src="~/Scripts/jquery-3.3.1.js"></script>
<script src="~/Scripts/jquery.validate.min.js"></script>
<script src="~/Scripts/jquery.validate.unobtrusive.min.js"></script>
<script src="~/Scripts/jquery.unobtrusive-ajax.min.js"></script>
@*<script src="~/Scripts/app/search.js"></script>*@
<script src="~/Scripts/app/ActivoP.js"></script>


<script>
 $(document).ready(function () {
        if (prod_EsActivo.checked) {         
            $('#RazonInactivo').hide();           
        } else {           
            $('#RazonInactivo').show();
        }
 });
</script>

<script>
        console.log('Hla')


        $(document).ready(function () {
            var Mun = $('#pscat_Id').val();

            console.log(Mun);
            if (Mun != '') {
                GetCategoriaProducto();
                //GetMunicipios();
            }

        });

        function GetCategoriaProducto() {
            var codsubcategoria = $('#pscat_Id').val();
            $.ajax({
                url: "/Producto/GetCategoriaProducto",
                method: "POST",
                dataType: 'json',
                contentType: "application/json; charset=utf-8",
                data: JSON.stringify({ codsubcategoria: codsubcategoria }),
            })
                .done(function (data) {
                    if (data.length > 0) {
                        $('#pcat_Id').empty();                       
                        $.each(data, function (key, val) {
                            $('#pcat_Id').append("<option value=" + val.pcat_Id + ">" + val.pcat_Nombre + "</option>");
                        });
                        $('#pcat_Id').trigger("chosen:updated");
                    }
                    else {
                        $('#pcat_Id').empty();
                        $('#pcat_Id').append("<option value=" + val.pcat_Id + ">" + val.pcat_Nombre + "</option>");
                    }
                });

        }


                //function GetMunicipios() {
                //    var CodDepartamento = $('#dep_Codigo').val();
                //    $.ajax({
                //        url: "/Bodega/GetMunicipios",
                //        method: "POST",
                //        dataType: 'json',
                //        contentType: "application/json; charset=utf-8",
                //        data: JSON.stringify({ CodDepartamento: CodDepartamento }),
                //    })
                //        .done(function (data) {
                //            if (data.length > 0) {
                //                $('#mun_Codigo').empty();
                //                $('#mun_Codigo').append("<option value=''>Seleccione</option>");
                //                $.each(data, function (key, val) {
                //                    $('#mun_Codigo').append("<option value=" + val.mun_Codigo + ">" + val.mun_Nombre + "</option>");
                //                });
                //                $('#mun_Codigo').trigger("chosen:updated");
                //            }
                //            else {
                //                $('#mun_Codigo').empty();
                //                $('#mun_Codigo').append("<option value=" + val.mun_Codigo + ">" + " Seleccione </option>");
                //            }
                //        });
                //}

</script>