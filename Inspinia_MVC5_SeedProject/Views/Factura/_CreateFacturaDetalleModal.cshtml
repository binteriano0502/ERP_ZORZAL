@model ERP_GMEDINA.Models.tbFacturaDetalle
@using ERP_GMEDINA.Models
<div class="wrapper">
    <div class="row">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="ibox-content">
                    <div class="form-horizontal">
                        <div class="form-group">
                            <label class="col-md-1 required">Codigo Barra</label>
                            <div class="col-md-3">
                                <input id="prod_CodigoBarras" type="text" class="form-control" />
                            </div>
                            <div class="col-md-1">
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#ModalAgregarProducto"><span class="glyphicon glyphicon-search"></span></button>
                            </div>
                            @Html.LabelFor(model => model.tbProducto.prod_Descripcion, new { @class = "control-label col-md-1" })
                            <div class="col-md-5">
                                @Html.EditorFor(model => model.tbProducto.prod_Descripcion, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control", @readonly = "readonly", } })
                                <div id="validationDescripcionProductoCreate">
                                    @Html.ValidationMessageFor(model => model.tbProducto.prod_Descripcion)
                                </div>
                            </div>
                            <div class="col-md-1">
                                <button class="btn btn-primary btn-sm" type="button" id="AgregarDetalleFactura">Añadir</button>
                            </div>
                        </div>

                        <div class="form-group">

                            @Html.LabelFor(model => model.prod_Codigo, new { @class = "control-label required col-md-1" })
                            <div class="col-md-3">
                                @Html.EditorFor(model => model.prod_Codigo, new { htmlAttributes = new { @autocomplete = "off", @class = "form-control" } })
                                <div id="validationCodigoProductoCreate">
                                    <p style="color:red">@Html.ValidationMessageFor(model => model.prod_Codigo)</p>
                                </div>
                            </div>

                            @Html.LabelFor(model => model.factd_PorcentajeDescuento, new { @class = "col-md-1 col-md-offset-1" })
                            <div class="col-md-2">
                                @Html.EditorFor(model => model.factd_PorcentajeDescuento, new { htmlAttributes = new { @Value = "", onKeyPress = "return soloNumeros(event)", @autocomplete = "off" } })
                                <p style="color:red">@Html.ValidationMessageFor(model => model.factd_PorcentajeDescuento)</p>
                            </div>
                            @Html.LabelFor(model => model.factd_MontoDescuento, new { @class = "col-md-1" })
                            <div class="col-md-2">
                                @Html.EditorFor(model => model.factd_MontoDescuento, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly", @Value = "", @onkeyup = "format(this)", @autocomplete = "off" } })
                                <div id="validationMontoDescuentoCreate">
                                    @Html.ValidationMessageFor(model => model.factd_MontoDescuento)
                                </div>
                            </div>
                            <div class="col-md-1">
                                <button type="button" class="btn btn-primary btn-sm" data-backdrop="static" data-keyboard="false" data-toggle="modal" data-target="#AutorizarDescuentoDetalle">Descuento</button>
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(model => model.factd_Cantidad, new { @class = "control-label required col-md-1" })
                            <div class="col-md-3">
                                @Html.EditorFor(model => model.factd_Cantidad, new { htmlAttributes = new { @Value = "", onKeyPress = "return soloNumeros(event)", onKeyUp = "pierdeFoco(this)", @autocomplete = "off" } })
                                <div id="validationCantidadProductoCreate">
                                    <p style="color:red">@Html.ValidationMessageFor(model => model.factd_Cantidad)</p>
                                </div>
                            </div>
                            @Html.LabelFor(model => model.factd_Impuesto, "% Impuesto", new { @class = "control-label col-md-2" })
                            <div class="col-md-2">
                                @Html.EditorFor(model => model.factd_Impuesto, new { htmlAttributes = new { @Value = "", @autocomplete = "off", @class = "form-control", @readonly = "readonly" } })
                                <div id="validationImpuestoProductoCreate">
                                    @Html.ValidationMessageFor(model => model.factd_Impuesto)
                                </div>
                            </div>
                            <label class="control-label col-md-1">Impuesto</label>
                            <div class="col-md-2">
                                <input id="Impuesto" type="text" class="form-control" readonly />
                            </div>
                        </div>
                        <div class="form-group">
                            @Html.LabelFor(model => model.factd_PrecioUnitario, new { @class = "control-label col-md-1" })
                            <div class="col-md-3">
                                @Html.EditorFor(model => model.factd_PrecioUnitario, new { htmlAttributes = new { @class = "form-control", @Value = "", @autocomplete = "off", @readonly = "readonly" } })
                                <div id="validationPrecioUnitarioCreate">
                                    <p style="color:red">@Html.ValidationMessageFor(model => model.factd_PrecioUnitario)</p>
                                </div>
                            </div>
                            <label class="control-label col-md-2">Subtotal</label>
                            <div class="col-md-2">
                                <input id="SubtotalProducto" type="text" class="form-control" readonly />
                            </div>
                            <label class="control-label col-md-1">Total</label>
                            <div class="col-md-2">
                                <input id="TotalProducto" type="text" value="" class="form-control" readonly />
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<table id="tblDetalleFactura" class="table table-striped table-bordered table-hover dataTables-example">
    <thead>
        <tr>
            <th>ID Producto</th>
            <th>Descripción Producto</th>
            <th>Cantidad</th>
            <th>Valor Unit.</th>
            <th>Impuesto.</th>
            <th>Descuento</th>
            <th>Total</th>
            <th></th>
        </tr>
    </thead>
    <tbody></tbody>
    <tfoot>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Descuento</td>
            <td><p id="TotalDescuento" style="text-align:right"></p></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Sub-Total</td>
            <td><p id="Subtotal" style="text-align:right"></p></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>ISV</td>
            <td><p id="isv" style="text-align:right"></p></td>
            <td></td>
        </tr>
        <tr>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td></td>
            <td>Total a Pagar</td>
            <td><p id="total" style="text-align:right"></p></td>
            <th></th>
        </tr>

</table>
<div id="validationSummary">
    <p style="color:red"></p>
</div>
<div>
    <div class="modal fade" id="AutorizarDescuentoDetalle" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close" id="CloseAutorizarDetalle">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">Código Autorizado</h4>
                </div>
                <div class="modal-body" id="frmAutorizarDescuento">
                    <div class="ibox-content">
                        <div class="form-horizontal">
                            <form method="post">
                                <div class="form-group">
                                    <label class="control-label col-md-4">Contraseña</label>
                                    <div class="col-md-6">
                                        <input id="passdetalle" name="pass" class="form-control" autocomplete="on">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="control-label col-md-4">Porcentaje de Descuento</label>
                                    <div class="col-md-6">
                                        <input id="PorcentajeDescuentoAuditoria" type="text" class="form-control" />
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<div>
    <div class="modal fade" id="ModalAgregarProducto" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                    <h4 class="modal-title" id="myModalLabel">Agregar Producto</h4>
                </div>
                <div class="modal-body" id="frmListaProducto">
                    @Html.Partial("_IndexProducto", (List<tbProducto>)ViewBag.Producto)
                </div>
            </div>
        </div>
    </div>
</div>
<script src="~/Scripts/app/CalculoFactura.js"></script>
<script>
    $("#prod_CodigoBarras").on("keypress keyup blur", function (event) {
        var Value = $(this).val();
        if (Value == '') {
            $('#prod_Codigo').val('');
            $('#tbProducto_prod_Descripcion').val('');
            $('#factd_Impuesto').val(0.00);
            $('#factd_PrecioUnitario').val(0.00);
            $('#factd_Cantidad').val(''),
            $("#factd_PrecioUnitario").val(0.00),
            $("#SubtotalProducto").val(0.00),
            $("#TotalProducto").val(0.00)
            $("#Impuesto").val('')
        }
    });

    var contador = 0;
    $(document).keypress(function (e) {
        console.log('Hola', e.target.id);
        var IDInput = e.target.id;
        if (e.which == 13) {
            if (IDInput == 'prod_CodigoBarras') {
                ///
                $(function () {
                    var IDSucursal = $('#suc_Id').val();
                    var CodBarra = $('#prod_CodigoBarras').val();
                    var IDCliente = $('#clte_Id').val();
                    $.ajax({
                        type: 'POST',
                        url: '/Factura/BuscarCodigoBarras',
                        data: JSON.stringify({ IDSucursal: IDSucursal, CodBarra: CodBarra, IDCliente: IDCliente }),
                        contentType: 'application/json;',
                        dataType: 'json',
                    }).done(function (data) {
                        if (data.length > 0) {
                            $.each(data, function (key, val) {
                                if (val.EXISTE) {
                                    console.log('each')
                                    data_producto = val.CODIGOPRODUCTO;
                                    data_descripcion = val.DESCRIPCIONPRODUCTO;
                                    data_impuesto = val.IMPUESTOPRODUCTO;
                                    data_precio = val.PRECIOUNITARIO;
                                    $('#prod_Codigo').val(data_producto);
                                    $('#tbProducto_prod_Descripcion').val(data_descripcion);
                                    $('#factd_Impuesto').val(data_impuesto);
                                    $('#factd_PrecioUnitario').val(data_precio);
                                    $('#factd_Cantidad').val(1);


                                    var Cantidad = 1,
                                        Precio = $("#factd_PrecioUnitario").val(),
                                        Impuesto = $("#factd_Impuesto").val(),
                                    result = "";
                                    result1 = "";
                                    if (Cantidad && Precio > 0) {
                                        result += Cantidad * Precio;
                                    }

                                    $("#SubtotalProducto").val(result);
                                    Subtotal = $("#SubtotalProducto").val(),
                                    PorcentajeImpuesto = ((parseFloat(Impuesto) / 100) * Subtotal);
                                    result1 += PorcentajeImpuesto;
                                    console.log(result1)
                                    $("#Impuesto").val(result1);
                                    var Descuento = $("#factd_PorcentajeDescuento").val();
                                    var Subtotal = $("#SubtotalProducto").val();
                                    var impuesto = $("#factd_Impuesto").val();
                                    if (Descuento == '') {
                                        Descuento = 0
                                    }
                                    var PorcentajeDescuento = (parseFloat(Descuento) / 100);
                                    var PorcentajeImpuesto = (parseFloat(impuesto) / 100);
                                    var DescuentoTotal = (parseFloat(Subtotal) * parseFloat(PorcentajeDescuento));
                                    var impuestotal = (Subtotal * PorcentajeImpuesto);
                                    result = "";

                                    if (PorcentajeDescuento && Cantidad == '') {
                                        result += (parseFloat(Subtotal) + parseFloat(impuestotal));
                                    }
                                    else if (DescuentoTotal && Cantidad == 0) {
                                        result += (parseFloat(Subtotal) + parseFloat(impuestotal));
                                    }
                                    else {
                                        result += (parseFloat(Subtotal) - parseFloat(DescuentoTotal) + parseFloat(impuestotal));
                                    }
                                    if (Descuento == '') {
                                        $("#factd_PorcentajeDescuento").val(0);
                                    }
                                    if (Cantidad == '') {
                                        $("#factd_MontoDescuento").val('');
                                    }
                                    else {
                                        $("#factd_MontoDescuento").val(DescuentoTotal);
                                    }
                                    if (Descuento && Cantidad == '') {
                                        $("#TotalProducto").val('');
                                    }
                                    else {
                                        $("#TotalProducto").val(result);

                                        var CodigoProducto = $('#prod_Codigo').val();
                                        var PorcentajeDescuento = $('#factd_PorcentajeDescuento').val();
                                        var MontoDescuento = $('#factd_MontoDescuento').val();
                                        var DescripcionProducto = $('#tbProducto_prod_Descripcion').val();
                                        var CantidadProducto = $('#factd_Cantidad').val();
                                        var Subtotal = $('#SubtotalProducto').val();
                                        var PrecioUnitario = $('#factd_PrecioUnitario').val();
                                        var Impuesto = $('#factd_Impuesto').val();
                                        var Total = $('#TotalProducto').val();
                                        //Prueba
                                        contador = contador + 1;
                                        copiar = "<tr data-id=" + contador + ">";
                                        copiar += "<td id = 'prod_CodigoCreate'>" + data_producto + "</td>";
                                        copiar += "<td id = 'tbProducto_prod_DescripcionCreate'>" + data_descripcion + "</td>";
                                        copiar += "<td id = 'factd_CantidadCreate' align='right'>" + 1 + "</td>";
                                        copiar += "<td id = 'Precio_UnitarioCreate' align='right'>" + data_precio + "</td>";
                                        copiar += "<td id = 'ImpuestoCreate' align='right'>" + data_impuesto + "</td>";
                                        copiar += "<td id = 'factd_MontoDescuentoCreate' align='right'>" + DescuentoTotal + "</td>";
                                        copiar += "<td id = 'TotalProductoCreate' align='right'>" + result + "</td>";
                                        copiar += "<td>" + '<button id="removeFacturaDetalle" class="btn btn-danger btn-xs eliminar" type="button">-</button>' + "</td>";
                                        copiar += "</tr>";
                                        $('#tblDetalleFactura').append(copiar);

                                        //Descuento
                                        var Descuento = $('#factd_MontoDescuento').val();
                                        var TotalDescuento = parseFloat(document.getElementById("TotalDescuento").innerHTML);

                                        if (document.getElementById("TotalDescuento").innerHTML == '') {
                                            totalProducto = $('#factd_MontoDescuento').val();
                                            document.getElementById("TotalDescuento").innerHTML = parseFloat(totalProducto);
                                        }
                                        else {
                                            document.getElementById("TotalDescuento").innerHTML = parseFloat(TotalDescuento) + parseFloat(Descuento);
                                        }

                                        //Subtotal
                                        var totalProducto = $('#SubtotalProducto').val();
                                        var subtotal = parseFloat(document.getElementById("Subtotal").innerHTML);

                                        if (document.getElementById("Subtotal").innerHTML == '') {
                                            totalProducto = $('#SubtotalProducto').val();
                                            document.getElementById("Subtotal").innerHTML = parseFloat(totalProducto);
                                        }
                                        else {
                                            document.getElementById("Subtotal").innerHTML = parseFloat(subtotal) + parseFloat(totalProducto);
                                        }
                                        //Impuesto
                                        var Cantidad = CantidadProducto
                                        var Precio = PrecioUnitario
                                        var impuesto = parseFloat(document.getElementById("factd_Impuesto").value.replace(',', '.'));
                                        var impuestotal = parseFloat(document.getElementById("isv").innerHTML);
                                        var porcentaje = parseFloat(impuesto / 100);
                                        var impuestos = (Cantidad * Precio) * porcentaje;
                                        console.log(impuestos)

                                        if (document.getElementById("isv").innerHTML == '') {
                                            impuesto = document.getElementById("factd_Impuesto").value;
                                            document.getElementById("isv").innerHTML = parseFloat(impuestos);
                                        }
                                        else {
                                            document.getElementById("isv").innerHTML = parseFloat(impuestotal) + parseFloat(impuestos);
                                        }

                                        //Grantotal
                                        if (document.getElementById("total").innerHTML == '') {
                                            var TotalEncabezado = document.getElementById("total").innerHTML = parseFloat(totalProducto) + parseFloat(impuestos) - parseFloat(Descuento);
                                            $("#TotalProductoEncabezado").val(TotalEncabezado);
                                        }
                                        else {
                                            var TotalEncabezado = document.getElementById("total").innerHTML = parseFloat(subtotal) + parseFloat(totalProducto) + parseFloat(impuestotal) + parseFloat(impuestos) - parseFloat(TotalDescuento) - parseFloat(Descuento);
                                            $("#TotalProductoEncabezado").val(TotalEncabezado);
                                        }

                                        var FacturaDetalle = GetFacturaDetalle();
                                        $.ajax({
                                            url: "/Factura/SaveFacturaDetalle",
                                            method: "POST",
                                            dataType: 'json',
                                            contentType: "application/json; charset=utf-8",
                                            data: JSON.stringify({ FacturaDetalleC: FacturaDetalle }),
                                        })
                                        .done(function (data) {
                                            $('#ErrorCodigoProductoCreate').text('');
                                            $('#ErrorMontoDescuentoCreate').text('');
                                            $('#ErrorCantidadCreate').text('');
                                            $('#ErrorImpuestoCreate').text('');
                                            ////Input
                                            //$('#prod_Codigo').val('');
                                            //$('#factd_MontoDescuento').val('');
                                            //$('#Impuesto').val('');
                                            //$('#tbProducto_prod_Descripcion').val('');
                                            //$('#factd_Cantidad').val('');
                                            //$('#SubtotalProducto').val('');
                                            //$('#factd_PrecioUnitario').val('');
                                            //$('#factd_Impuesto').val('');
                                            //$('#TotalProducto').val('');
                                        });
                                        //Fin Prueba



                                    }

                                    if ($("#factd_Cantidad").val(), $("#factd_PrecioUnitario").val() == '') {
                                        $("#factd_MontoDescuento").val('');
                                        $("#TotalProducto").val('');
                                    }

                                }
                                else {
                                    alert("Este producto no esta en existencia.")
                                    $("#prod_CodigoBarras").val('')
                                }

                            })

                            $('#AgregarDetalleFactura').keypress(function () {
                                console.log('boton');
                                var CodigoProducto = $('#prod_Codigo').val();
                                var PorcentajeDescuento = $('#factd_PorcentajeDescuento').val();
                                var MontoDescuento = $('#factd_MontoDescuento').val();
                                var DescripcionProducto = $('#tbProducto_prod_Descripcion').val();
                                var CantidadProducto = $('#factd_Cantidad').val();
                                var Subtotal = $('#SubtotalProducto').val();
                                var PrecioUnitario = $('#factd_PrecioUnitario').val();
                                var Impuesto = $('#factd_Impuesto').val();
                                var Total = $('#TotalProducto').val();

                                if (CodigoProducto == '') {
                                    $('#ErrorCodigoProductoCreate').text('');
                                    $('#ErrorMontoDescuentoCreate').text('');
                                    $('#ErrorCantidadCreate').text('');
                                    $('#ErrorImpuestoCreate').text('');
                                    $('#validationCodigoProductoCreate').after('<ul id="ErrorCodigoProductoCreate" class="validation-summary-errors text-danger">Campo Código Producto requerido</ul>');
                                }
                                else if (MontoDescuento == '') {
                                    $('#ErrorCodigoProductoCreate').text('');
                                    $('#ErrorMontoDescuentoCreate').text('');
                                    $('#ErrorCantidadCreate').text('');
                                    $('#ErrorImpuestoCreate').text('');
                                    $('#validationMontoDescuentoCreate').after('<ul id="ErrorMontoDescuentoCreate" class="validation-summary-errors text-danger">Campo Monto Descuento requerido</ul>');
                                }
                                else if (CantidadProducto == '') {
                                    $('#ErrorCodigoProductoCreate').text('');
                                    $('#ErrorMontoDescuentoCreate').text('');
                                    $('#ErrorCantidadCreate').text('');
                                    $('#ErrorImpuestoCreate').text('');
                                    $('#validationCantidadProductoCreate').after('<ul id="ErrorCantidadCreate" class="validation-summary-errors text-danger">Campo Cantidad requerido</ul>');
                                }
                                else if (Impuesto == '') {
                                    $('#ErrorCodigoProductoCreate').text('');
                                    $('#ErrorMontoDescuentoCreate').text('');
                                    $('#ErrorCantidadCreate').text('');
                                    $('#ErrorImpuestoCreate').text('');
                                    $('#validationImpuestoProductoCreate').after('<ul id="ErrorImpuestoCreate" class="validation-summary-errors text-danger">Campo Impuesto requerido</ul>');
                                }
                                else {
                                    contador = contador + 1;
                                    copiar = "<tr data-id=" + contador + ">";
                                    copiar += "<td id = 'prod_CodigoCreate'>" + CodigoProducto + "</td>";
                                    copiar += "<td id = 'tbProducto_prod_DescripcionCreate'>" + DescripcionProducto + "</td>";
                                    copiar += "<td id = 'factd_CantidadCreate' align='right'>" + CantidadProducto + "</td>";
                                    copiar += "<td id = 'Precio_UnitarioCreate' align='right'>" + PrecioUnitario + "</td>";
                                    copiar += "<td id = 'ImpuestoCreate' align='right'>" + Impuesto + "</td>";
                                    copiar += "<td id = 'factd_MontoDescuentoCreate' align='right'>" + MontoDescuento + "</td>";
                                    copiar += "<td id = 'TotalProductoCreate' align='right'>" + Total + "</td>";
                                    copiar += "<td>" + '<button id="removeFacturaDetalle" class="btn btn-danger btn-xs eliminar" type="button">-</button>' + "</td>";
                                    copiar += "</tr>";
                                    $('#tblDetalleFactura').append(copiar);
                                    //Descuento
                                    var Descuento = $('#factd_MontoDescuento').val();
                                    var TotalDescuento = parseFloat(document.getElementById("TotalDescuento").innerHTML);

                                    if (document.getElementById("TotalDescuento").innerHTML == '') {
                                        totalProducto = $('#factd_MontoDescuento').val();
                                        document.getElementById("TotalDescuento").innerHTML = parseFloat(totalProducto);
                                    }
                                    else {
                                        document.getElementById("TotalDescuento").innerHTML = parseFloat(TotalDescuento) + parseFloat(Descuento);
                                    }

                                    //Subtotal
                                    var totalProducto = $('#SubtotalProducto').val();
                                    var subtotal = parseFloat(document.getElementById("Subtotal").innerHTML);

                                    if (document.getElementById("Subtotal").innerHTML == '') {
                                        totalProducto = $('#SubtotalProducto').val();
                                        document.getElementById("Subtotal").innerHTML = parseFloat(totalProducto);
                                    }
                                    else {
                                        document.getElementById("Subtotal").innerHTML = parseFloat(subtotal) + parseFloat(totalProducto);
                                    }
                                    //Impuesto
                                    var Cantidad = CantidadProducto
                                    var Precio = PrecioUnitario
                                    var impuesto = parseFloat(document.getElementById("factd_Impuesto").value.replace(',', '.'));
                                    var impuestotal = parseFloat(document.getElementById("isv").innerHTML);
                                    var porcentaje = parseFloat(impuesto / 100);
                                    var impuestos = (Cantidad * Precio) * porcentaje;
                                    console.log(impuestos)

                                    if (document.getElementById("isv").innerHTML == '') {
                                        impuesto = document.getElementById("factd_Impuesto").value;
                                        document.getElementById("isv").innerHTML = parseFloat(impuestos);
                                    }
                                    else {
                                        document.getElementById("isv").innerHTML = parseFloat(impuestotal) + parseFloat(impuestos);
                                    }

                                    //Grantotal
                                    if (document.getElementById("total").innerHTML == '') {
                                        var TotalEncabezado = document.getElementById("total").innerHTML = parseFloat(totalProducto) + parseFloat(impuestos) - parseFloat(Descuento);
                                        $("#TotalProductoEncabezado").val(TotalEncabezado);
                                    }
                                    else {
                                        var TotalEncabezado = document.getElementById("total").innerHTML = parseFloat(subtotal) + parseFloat(totalProducto) + parseFloat(impuestotal) + parseFloat(impuestos) - parseFloat(TotalDescuento) - parseFloat(Descuento);
                                        $("#TotalProductoEncabezado").val(TotalEncabezado);
                                    }


                                    var FacturaDetalle = GetFacturaDetalle();
                                    $.ajax({
                                        url: "/Factura/SaveFacturaDetalle",
                                        method: "POST",
                                        dataType: 'json',
                                        contentType: "application/json; charset=utf-8",
                                        data: JSON.stringify({ FacturaDetalleC: FacturaDetalle }),
                                    })
                                    .done(function (data) {
                                        $('#ErrorCodigoProductoCreate').text('');
                                        $('#ErrorMontoDescuentoCreate').text('');
                                        $('#ErrorCantidadCreate').text('');
                                        $('#ErrorImpuestoCreate').text('');
                                        //Input
                                        $('#prod_Codigo').val('');
                                        $('#factd_MontoDescuento').val('');
                                        $('#Impuesto').val('');
                                        $('#tbProducto_prod_Descripcion').val('');
                                        $('#factd_Cantidad').val('');
                                        $('#SubtotalProducto').val('');
                                        $('#factd_PrecioUnitario').val('');
                                        $('#factd_Impuesto').val('');
                                        $('#TotalProducto').val('');
                                    });
                                }
                            });
                            function GetFacturaDetalle() {

                                var FacturaDetalle = {
                                    prod_Codigo: $('#prod_Codigo').val(),
                                    factd_PorcentajeDescuento: $('#factd_PorcentajeDescuento').val(),
                                    factd_MontoDescuento: $('#factd_MontoDescuento').val(),
                                    tbProducto_prod_Descripcion: $('#tbProducto_prod_Descripcion').val(),
                                    factd_Cantidad: $('#factd_Cantidad').val(),
                                    SubtotalProducto: $('#SubtotalProducto').val(),
                                    factd_PrecioUnitario: $('#factd_PrecioUnitario').val(),
                                    factd_Impuesto: $('#factd_Impuesto').val(),
                                    TotalProducto: $('#TotalProducto').val(),
                                    factd_Id: contador
                                };
                                return FacturaDetalle
                            }
                        }

                    });

                    return false;
                });

                return false;
            }
            else
                return false;
        }
    });
</script>